import{_ as e,a as t,d as a,b as i}from"./index.711114fb.js";import{r as l,o,t as s,b as n,w as r,aF as d,a as c,aR as u,aE as h,aC as m,aA as p,aB as g,aS as f,v as y,ax as b}from"./ui.7155d707.js";const C={props:{api:{type:Object,required:!0},model:{type:Object,required:!0,default:()=>({accountName:{type:"string",default:null,label:"用户名",control:"el-input",controlOption:{},scope:["create","update"],required:!1,validator:null,message:null,asynValid:!1}})},columns:{type:Array,required:!0,default:()=>[{hidden:!1,slotName:""}]},dataKey:{type:String,required:!1,default:"id"},immediate:{type:Boolean,required:!1,default:!0},queryParam:{type:Object,required:!1,default:()=>({})},getItemFromDetaiApi:{type:Boolean,required:!1,default:!1},tableAttribute:{type:Object,required:!1,default:()=>({})},dialogAttribute:{type:Object,required:!1,default:()=>({})},formAttribute:{type:Object,required:!1,default:()=>({})}},filters:{formatterFilter:(e,t,a,i,l)=>"function"==typeof l?l(t,a,e,i):e},components:{CURDForm:()=>t((()=>import("./CURDForm.4c1128bc.js")),["assets/CURDForm.4c1128bc.js","assets/index.711114fb.js","assets/index.43470bb7.css","assets/ui.7155d707.js"]),CURDColumn:()=>t((()=>import("./CURDColumn.3b686845.js")),["assets/CURDColumn.3b686845.js","assets/index.711114fb.js","assets/index.43470bb7.css","assets/ui.7155d707.js"])},data(){return{dialogVisible:!1,loading:!1,list:[],editForm:{},editScope:"",queryParamFinnal:{p:1,pageSize:20},totalCount:0,totalPage:0,selectionNode:null,table:{clearSelection:()=>this.$refs.table.clearSelection(),toggleRowSelection:(e,t)=>this.$refs.table.toggleRowSelection(e,t),toggleAllSelection:()=>this.$refs.table.toggleAllSelection(),toggleRowExpansion:(e,t)=>this.$refs.table.toggleRowExpansion(e,t),setCurrentRow:e=>this.$refs.table.setCurrentRow(e),clearSort:()=>this.$refs.table.clearSort(),clearFilter:e=>this.$refs.table.clearFilter(e),doLayout:()=>this.$refs.table.doLayout(),sort:(e,t)=>this.$refs.table.clearFilter(e,t)},form:{validate:e=>this.$refs.editForm.validate(e),validateField:(e,t)=>this.$refs.editForm.validateField(e,t),resetFields:()=>this.$refs.editForm.resetFields(),clearValidate:()=>this.$refs.editForm.clearValidate()}}},computed:{showPagination(){return this.list.length&&this.totalCount&&this.totalPage},modelKey(){return Object.keys(this.model)},modelData(){let e=Object.assign({},this.model);return this.modelKey.forEach((t=>{let a=Object.assign({},e[t]);e[t]=Object.assign({type:"string",default:{array:[],object:{}}[a.type]||null,control:{boolean:"el-switch",array:"DictCheckbox"}[a.type]||"el-input",scope:["create","update"],required:!!a.required},a),"el-input"===a.control&&(a.controlOption=Object.assign({maxlength:100},a.controlOption))})),e},modelValue(){let e={};return this.modelKey.map((t=>{e[t]=this.modelData[t].default})),e},columnsData(){return this.columns.filter((e=>"selection"===e.type?(this.selectionNode=Object.assign({},e),!1):!e.hidden)).map((e=>{let t=Object.assign({align:"center"},e);return"selection"!==t.type&&"expand"!==t.type||console.warn('BaseCURD组件：columns=>type属性只支持"default"和"index"'),t}))}},watch:{loading(){this.$emit("loading-state",this.loading)}},methods:{handleCurrentChange:function(e){this.queryParamFinnal.p=e,this.fetchList()},create(){this.editForm=Object.assign({},this.modelValue),this.editScope="create",this.dialogVisible=!0},update:async function(e){this.editForm=this.getItemFromDetaiApi?await this.fetchDetail(e[this.dataKey]):a(e),this.editScope="update",this.dialogVisible=!0},save(){this.$refs.editForm.validate((e=>{if(e){let e=a(this.editForm);this.handleCloseDialog();let t=this.api[this.editScope];if("function"!=typeof t)return console.warn(`api.${this.editScope}()未定义`);this.loading=!0,t(e).then((e=>{200===e.status?(this.$message({message:"操作成功",type:"success"}),this.fetchList()):this.$message({message:"操作失败",type:"warning"})})).catch((()=>{this.loading=!1}))}}))},delete(e){if(!e||!e[this.dataKey])return console.warn(`api.delete(): 参数${this.dataKey}无效`);this.$confirm("是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.loading=!0,this.api.delete({[this.dataKey]:e[this.dataKey]}).then((e=>{200===e.status?(this.fetchList(),this.$message({message:"删除成功",type:"success"})):this.$message({message:"删除失败",type:"warning"})})).catch((()=>{this.loading=!1}))})).catch((()=>{}))},handleCloseDialog:function(){this.dialogVisible=!1,this.editForm=Object.assign({},this.modelValue)},fetchDetail:function(e){return e?(this.loading=!0,this.api.detail({[this.dataKey]:e}).then((e=>(this.loading=!1,e.data))).catch((()=>{this.loading=!1}))):console.warn(`api.detail(): 参数${this.dataKey}无效`)},fetchList:function(e){e&&(this.queryParamFinnal.p=1),this.loading=!0,this.api.list(this.queryParamFinnal).then((e=>{this.loading=!1;const t=e.data;Array.isArray(t)?this.list=i(t):Array.isArray(t.list)&&(this.list=i(t.list),this.totalCount=t.totalCount,this.totalPage=t.totalPage)})).catch((()=>{this.loading=!1}))},search(){Object.assign(this.queryParamFinnal,this.queryParam,{p:this.queryParamFinnal.p,pageSize:this.queryParamFinnal.pageSize}),this.fetchList(!0)}},created(){let e=["list","detail","create","update","delete"].filter((e=>"function"!=typeof this.api[e]));e.length&&console.warn(`${e.map((e=>"api."+e+"()")).join("、")}未定义`),this.immediate&&this.search()}},$=b("确 定"),F=b("取 消");const w=e(C,[["render",function(e,t,a,i,b,C){const w=l("el-table-column"),j=l("CURDColumn"),D=l("el-table"),S=l("Pagination"),q=l("CURDForm"),O=l("el-button"),k=l("el-dialog");return o(),s("div",null,[n(D,h({ref:"table",data:b.list},Object.assign({border:!0,"default-expand-all":!0,"row-key":"id"},a.tableAttribute),{onSelect:t[0]||(t[0]=(t,a)=>e.$emit("select",t,a)),onSelectAll:t[1]||(t[1]=t=>e.$emit("select-all",t)),onSelectionChange:t[2]||(t[2]=t=>e.$emit("selection-change",t)),onCellMouseEnter:t[3]||(t[3]=(t,a,i,l)=>e.$emit("cell-mouse-enter",t,a,i,l)),onCellMouseLeave:t[4]||(t[4]=(t,a,i,l)=>e.$emit("cell-mouse-leave",t,a,i,l)),onCellClick:t[5]||(t[5]=(t,a,i,l)=>e.$emit("cell-click",t,a,i,l)),onCellDblclick:t[6]||(t[6]=(t,a,i,l)=>e.$emit("cell-dblclick",t,a,i,l)),onRowClick:t[7]||(t[7]=(t,a,i)=>e.$emit("row-click",t,a,i)),onRowContextmenu:t[8]||(t[8]=(t,a,i)=>e.$emit("row-click",t,a,i)),onRowDblclick:t[9]||(t[9]=(t,a,i)=>e.$emit("row-dblclick",t,a,i)),onHeaderClick:t[10]||(t[10]=(t,a)=>e.$emit("header-click",t,a)),onHeaderContextmenu:t[11]||(t[11]=(t,a)=>e.$emit("header-contextmenu",t,a)),onSortChange:t[12]||(t[12]=(t,a,i)=>e.$emit("sort-change",t,a,i)),onFilterChange:t[13]||(t[13]=t=>e.$emit("filter-change",t)),onCurrentChange:t[14]||(t[14]=(t,a)=>e.$emit("current-change",t,a)),onHeaderDragend:t[15]||(t[15]=(t,a,i,l)=>e.$emit("header-dragend",t,a,i,l)),onExpandChange:t[16]||(t[16]=(t,a)=>e.$emit("expand-change",t,a))}),{append:r((()=>[d(e.$slots,"append")])),default:r((()=>[b.selectionNode&&"selection"===b.selectionNode.type?(o(),c(w,u(h({key:0},b.selectionNode)),null,16)):m("",!0),(o(!0),s(p,null,g(C.columnsData,((t,a)=>(o(),c(j,{column:t},f({_:2},[g(Object.keys(e.$scopedSlots),(t=>({name:"slotName",fn:r((a=>[d(e.$slots,t,{column:a.column,row:a.row,prop:a.prop})]))})))]),1032,["column"])))),256))])),_:3},16,["data"]),C.showPagination?(o(),c(S,{key:0,"page-size":b.queryParamFinnal.pageSize,"current-page":b.queryParamFinnal.p,"total-count":b.totalCount,"total-page":b.totalPage,onCurrentChange:C.handleCurrentChange},null,8,["page-size","current-page","total-count","total-page","onCurrentChange"])):m("",!0),n(k,h({modelValue:b.dialogVisible,"onUpdate:modelValue":t[18]||(t[18]=e=>b.dialogVisible=e)},Object.assign({title:"详情",width:"800px","close-on-click-modal":!1,"append-to-body":!0},a.dialogAttribute),{onClose:C.handleCloseDialog}),{footer:r((()=>[y("div",null,[n(O,{type:"primary",onClick:C.save},{default:r((()=>[$])),_:1},8,["onClick"]),n(O,{onClick:t[17]||(t[17]=e=>b.dialogVisible=!1)},{default:r((()=>[F])),_:1})])])),default:r((()=>[b.dialogVisible?(o(),c(q,{key:0,ref:"editForm",model:C.modelData,default:b.editForm,action:b.editScope,formAttribute:a.formAttribute},null,8,["model","default","action","formAttribute"])):m("",!0)])),_:1},16,["modelValue","onClose"])])}]]);export{w as default};
