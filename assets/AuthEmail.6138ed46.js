import{_ as t,N as e,O as a,r as i,o as l,g as s,w as n,l as u,t as r,h as o,e as d,v as m}from"./index.cc0542f8.js";const f={name:"AuthEmail",emits:["success"],data(){return{loading:!1,formData:{id:null,userInput:null,inputEmail:null},rules:{inputEmail:[{validator:(t,e,a)=>{if(e){if(this.userEmail&&this.userEmail!==e)return a(new Error("邮箱不正确"));a()}else a(new Error("请输入安全邮箱"))},trigger:[]}],userInput:[{required:!0,message:"请输入验证码",trigger:"blur"},{min:4,max:6,message:"请输入正确的验证码",trigger:"blur"}]},buttonDisabled:!1}},computed:{userEmail(){return this.$store.user.email||""},anonymousEmail(){if(this.userEmail){const t=this.userEmail.split("@")[0].split("");return`${t.map(((e,a)=>0===a||a===t.length-1?e:"*")).join("")}@${this.userEmail.split("@")[1]}`}return""}},methods:{sendValidCode(){this.$refs.form.validateField("inputEmail",(t=>{t||(this.loading=!0,e({email:this.formData.inputEmail}).then((t=>{this.loading=!1,200===t.status?(this.formData.id=t.data.id,this.$refs.countdownButton.start()):this.$message.warning("验证邮件发送失败，请稍后重试")})).catch((()=>{this.loading=!1})))}))},handleSubmit(){this.$refs.form.validateField("userInput",(t=>{t||(this.loading=!0,a(this.formData).then((t=>{this.loading=!1,200===t.status?this.$emit("success",t.data):(this.$refs.form.resetFields(),this.$message.warning("验证失败"))})).catch((()=>{this.loading=!1})))}))}}},p=u(" 获取验证码 "),h=u(" 立即验证 ");const c=t(f,[["render",function(t,e,a,f,c,g){const E=i("el-form-item"),b=i("Message"),D=i("el-icon"),_=i("el-input"),$=i("CountDown"),w=i("el-button"),v=i("el-form");return l(),s(v,{ref:"form",model:c.formData,rules:c.rules,"label-position":"left",class:"auth_email","v-loading":c.loading,onSubmit:m(g.handleSubmit,["prevent"])},{default:n((()=>[g.anonymousEmail?(l(),s(E,{key:0},{default:n((()=>[u("安全邮箱："+r(g.anonymousEmail),1)])),_:1})):o("",!0),d(E,{prop:"inputEmail"},{default:n((()=>[d(_,{modelValue:c.formData.inputEmail,"onUpdate:modelValue":e[0]||(e[0]=t=>c.formData.inputEmail=t),placeholder:"请输入安全邮箱"},{prefix:n((()=>[d(D,null,{default:n((()=>[d(b)])),_:1})])),_:1},8,["modelValue"])])),_:1}),d(E,{prop:"userInput"},{default:n((()=>[d(_,{modelValue:c.formData.userInput,"onUpdate:modelValue":e[3]||(e[3]=t=>c.formData.userInput=t),placeholder:"请输入验证码"},{append:n((()=>[d(w,{disabled:c.buttonDisabled,onClick:g.sendValidCode},{default:n((()=>[d($,{ref:"countdownButton",count:30,onStart:e[1]||(e[1]=t=>c.buttonDisabled=!0),onEnd:e[2]||(e[2]=t=>c.buttonDisabled=!1)},{default:n((()=>[p])),_:1},512)])),_:1},8,["disabled","onClick"])])),_:1},8,["modelValue"])])),_:1}),d(E,null,{default:n((()=>[d(w,{"native-type":"submit",type:"primary",style:{width:"100%"}},{default:n((()=>[h])),_:1})])),_:1})])),_:1},8,["model","rules","v-loading","onSubmit"])}]]);export{c as default};
