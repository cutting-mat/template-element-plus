import{_ as D,N as v,O as V,r as n,o as _,g as h,w as t,l as d,t as w,h as C,e as l,v as y}from"./index.cc0542f8.js";const S={name:"AuthEmail",emits:["success"],data(){return{loading:!1,formData:{id:null,userInput:null,inputEmail:null},rules:{inputEmail:[{validator:(e,o,a)=>{if(!o)a(new Error("\u8BF7\u8F93\u5165\u5B89\u5168\u90AE\u7BB1"));else{if(this.userEmail&&this.userEmail!==o)return a(new Error("\u90AE\u7BB1\u4E0D\u6B63\u786E"));a()}},trigger:[]}],userInput:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",trigger:"blur"},{min:4,max:6,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9A8C\u8BC1\u7801",trigger:"blur"}]},buttonDisabled:!1}},computed:{userEmail(){return this.$store.user.email||""},anonymousEmail(){if(this.userEmail){const s=this.userEmail.split("@")[0].split("");return`${s.map((o,a)=>a===0||a===s.length-1?o:"*").join("")}@${this.userEmail.split("@")[1]}`}return""}},methods:{sendValidCode(){this.$refs.form.validateField("inputEmail",s=>{s||(this.loading=!0,v({email:this.formData.inputEmail}).then(e=>{this.loading=!1,e.status===200?(this.formData.id=e.data.id,this.$refs.countdownButton.start()):this.$message.warning("\u9A8C\u8BC1\u90AE\u4EF6\u53D1\u9001\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5")}).catch(()=>{this.loading=!1}))})},handleSubmit(){this.$refs.form.validateField("userInput",s=>{s||(this.loading=!0,V(this.formData).then(e=>{this.loading=!1,e.status===200?this.$emit("success",e.data):(this.$refs.form.resetFields(),this.$message.warning("\u9A8C\u8BC1\u5931\u8D25"))}).catch(()=>{this.loading=!1}))})}}},x=d(" \u83B7\u53D6\u9A8C\u8BC1\u7801 "),N=d(" \u7ACB\u5373\u9A8C\u8BC1 ");function I(s,e,o,a,i,u){const m=n("el-form-item"),c=n("Message"),g=n("el-icon"),f=n("el-input"),E=n("CountDown"),p=n("el-button"),b=n("el-form");return _(),h(b,{ref:"form",model:i.formData,rules:i.rules,"label-position":"left",class:"auth_email","v-loading":i.loading,onSubmit:y(u.handleSubmit,["prevent"])},{default:t(()=>[u.anonymousEmail?(_(),h(m,{key:0},{default:t(()=>[d("\u5B89\u5168\u90AE\u7BB1\uFF1A"+w(u.anonymousEmail),1)]),_:1})):C("",!0),l(m,{prop:"inputEmail"},{default:t(()=>[l(f,{modelValue:i.formData.inputEmail,"onUpdate:modelValue":e[0]||(e[0]=r=>i.formData.inputEmail=r),placeholder:"\u8BF7\u8F93\u5165\u5B89\u5168\u90AE\u7BB1"},{prefix:t(()=>[l(g,null,{default:t(()=>[l(c)]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(m,{prop:"userInput"},{default:t(()=>[l(f,{modelValue:i.formData.userInput,"onUpdate:modelValue":e[3]||(e[3]=r=>i.formData.userInput=r),placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"},{append:t(()=>[l(p,{disabled:i.buttonDisabled,onClick:u.sendValidCode},{default:t(()=>[l(E,{ref:"countdownButton",count:30,onStart:e[1]||(e[1]=r=>i.buttonDisabled=!0),onEnd:e[2]||(e[2]=r=>i.buttonDisabled=!1)},{default:t(()=>[x]),_:1},512)]),_:1},8,["disabled","onClick"])]),_:1},8,["modelValue"])]),_:1}),l(m,null,{default:t(()=>[l(p,{"native-type":"submit",type:"primary",style:{width:"100%"}},{default:t(()=>[N]),_:1})]),_:1})]),_:1},8,["model","rules","v-loading","onSubmit"])}const k=D(S,[["render",I]]);export{k as default};
