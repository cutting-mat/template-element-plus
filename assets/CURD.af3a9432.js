import{_ as V,a as y,d as C,b as F,r as s,o as m,c as w,e as c,w as u,f as D,g,n as R,m as p,h,F as v,i as S,j as N,k as L,l as $}from"./index.07ef7170.js";const E={props:{api:{type:Object,required:!0},model:{type:Object,required:!0,default(){return{accountName:{type:"string",default:null,label:"\u7528\u6237\u540D",control:"el-input",controlOption:{},scope:["create","update"],required:!1,validator:null,message:null,asynValid:!1}}}},columns:{type:Array,required:!0,default(){return[{hidden:!1,slotName:""}]}},dataKey:{type:String,required:!1,default:"id"},immediate:{type:Boolean,required:!1,default:!0},queryParam:{type:Object,required:!1,default(){return{}}},getItemFromDetaiApi:{type:Boolean,required:!1,default:!1},tableAttribute:{type:Object,required:!1,default(){return{}}},dialogAttribute:{type:Object,required:!1,default(){return{}}},formAttribute:{type:Object,required:!1,default(){return{}}}},filters:{formatterFilter(t,e,a,f,n){return typeof n=="function"?n(e,a,t,f):t}},components:{CURDForm:()=>y(()=>import("./CURDForm.71ea66e8.js"),["assets/CURDForm.71ea66e8.js","assets/index.07ef7170.js","assets/index.39d4a6ad.css"]),CURDColumn:()=>y(()=>import("./CURDColumn.55356868.js"),["assets/CURDColumn.55356868.js","assets/index.07ef7170.js","assets/index.39d4a6ad.css"])},data(){return{dialogVisible:!1,loading:!1,list:[],editForm:{},editScope:"",queryParamFinnal:{p:1,pageSize:10},totalCount:0,totalPage:0,selectionNode:null,table:{clearSelection:()=>this.$refs.table.clearSelection(),toggleRowSelection:(t,e)=>this.$refs.table.toggleRowSelection(t,e),toggleAllSelection:()=>this.$refs.table.toggleAllSelection(),toggleRowExpansion:(t,e)=>this.$refs.table.toggleRowExpansion(t,e),setCurrentRow:t=>this.$refs.table.setCurrentRow(t),clearSort:()=>this.$refs.table.clearSort(),clearFilter:t=>this.$refs.table.clearFilter(t),doLayout:()=>this.$refs.table.doLayout(),sort:(t,e)=>this.$refs.table.clearFilter(t,e)},form:{validate:t=>this.$refs.editForm.validate(t),validateField:(t,e)=>this.$refs.editForm.validateField(t,e),resetFields:()=>this.$refs.editForm.resetFields(),clearValidate:()=>this.$refs.editForm.clearValidate()}}},computed:{showPagination(){return this.list.length&&this.totalCount&&this.totalPage},modelKey(){return Object.keys(this.model)},modelData(){let t=Object.assign({},this.model);return this.modelKey.forEach(e=>{let a=Object.assign({},t[e]);t[e]=Object.assign({type:"string",default:{array:[],object:{}}[a.type]||null,control:{boolean:"el-switch",array:"DictCheckbox"}[a.type]||"el-input",scope:["create","update"],required:!!a.required},a),a.control==="el-input"&&(a.controlOption=Object.assign({maxlength:100},a.controlOption))}),t},modelValue(){let t={};return this.modelKey.map(e=>{t[e]=this.modelData[e].default}),t},columnsData(){return this.columns.filter(t=>t.type==="selection"?(this.selectionNode=Object.assign({},t),!1):!t.hidden).map(t=>{let e=Object.assign({align:"center"},t);return(e.type==="selection"||e.type==="expand")&&console.warn('BaseCURD\u7EC4\u4EF6\uFF1Acolumns=>type\u5C5E\u6027\u53EA\u652F\u6301"default"\u548C"index"'),e})}},watch:{loading(){this.$emit("loading-state",this.loading)}},methods:{handleCurrentChange:function(t){this.queryParamFinnal.p=t,this.fetchList()},create(){this.editForm=Object.assign({},this.modelValue),this.editScope="create",this.dialogVisible=!0},update:async function(t){this.editForm=this.getItemFromDetaiApi?await this.fetchDetail(t[this.dataKey]):C(t),this.editScope="update",this.dialogVisible=!0},save(){this.$refs.editForm.validate(t=>{if(t){let e=C(this.editForm);this.handleCloseDialog();let a=this.api[this.editScope];if(typeof a!="function")return console.warn(`api.${this.editScope}()\u672A\u5B9A\u4E49`);this.loading=!0,a(e).then(f=>{f.status===200?(this.$message({message:"\u64CD\u4F5C\u6210\u529F",type:"success"}),this.fetchList()):this.$message({message:"\u64CD\u4F5C\u5931\u8D25",type:"warning"})}).catch(()=>{this.loading=!1})}})},delete(t){if(!t||!t[this.dataKey])return console.warn(`api.delete(): \u53C2\u6570${this.dataKey}\u65E0\u6548`);this.$confirm("\u662F\u5426\u5220\u9664?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{this.loading=!0,this.api.delete({[this.dataKey]:t[this.dataKey]}).then(e=>{e.status===200?(this.fetchList(),this.$message({message:"\u5220\u9664\u6210\u529F",type:"success"})):this.$message({message:"\u5220\u9664\u5931\u8D25",type:"warning"})}).catch(()=>{this.loading=!1})}).catch(()=>{})},handleCloseDialog:function(){this.dialogVisible=!1,this.editForm=Object.assign({},this.modelValue)},fetchDetail:function(t){return t?(this.loading=!0,this.api.detail({[this.dataKey]:t}).then(e=>(this.loading=!1,e.data)).catch(()=>{this.loading=!1})):console.warn(`api.detail(): \u53C2\u6570${this.dataKey}\u65E0\u6548`)},fetchList:function(t){t&&(this.queryParamFinnal.p=1),this.loading=!0,this.api.list(this.queryParamFinnal).then(e=>{this.loading=!1;const a=e.data;Array.isArray(a)?this.list=F(a):Array.isArray(a.list)&&(this.list=F(a.list),this.totalCount=a.totalCount,this.totalPage=a.totalPage)}).catch(()=>{this.loading=!1})},search(){Object.assign(this.queryParamFinnal,this.queryParam,{p:this.queryParamFinnal.p,pageSize:this.queryParamFinnal.pageSize}),this.fetchList(!0)}},created(){let t=["list","detail","create","update","delete"].filter(e=>typeof this.api[e]!="function");t.length&&console.warn(`${t.map(e=>"api."+e+"()").join("\u3001")}\u672A\u5B9A\u4E49`),this.immediate&&this.search()}},K=$("\u786E \u5B9A"),B=$("\u53D6 \u6D88");function U(t,e,a,f,n,d){const P=s("el-table-column"),k=s("CURDColumn"),q=s("el-table"),O=s("Pagination"),j=s("CURDForm"),b=s("el-button"),A=s("el-dialog");return m(),w("div",null,[c(q,p({ref:"table",data:n.list},Object.assign({border:!0,"default-expand-all":!0,"row-key":"id"},a.tableAttribute),{onSelect:e[0]||(e[0]=(i,l)=>t.$emit("select",i,l)),onSelectAll:e[1]||(e[1]=i=>t.$emit("select-all",i)),onSelectionChange:e[2]||(e[2]=i=>t.$emit("selection-change",i)),onCellMouseEnter:e[3]||(e[3]=(i,l,r,o)=>t.$emit("cell-mouse-enter",i,l,r,o)),onCellMouseLeave:e[4]||(e[4]=(i,l,r,o)=>t.$emit("cell-mouse-leave",i,l,r,o)),onCellClick:e[5]||(e[5]=(i,l,r,o)=>t.$emit("cell-click",i,l,r,o)),onCellDblclick:e[6]||(e[6]=(i,l,r,o)=>t.$emit("cell-dblclick",i,l,r,o)),onRowClick:e[7]||(e[7]=(i,l,r)=>t.$emit("row-click",i,l,r)),onRowContextmenu:e[8]||(e[8]=(i,l,r)=>t.$emit("row-click",i,l,r)),onRowDblclick:e[9]||(e[9]=(i,l,r)=>t.$emit("row-dblclick",i,l,r)),onHeaderClick:e[10]||(e[10]=(i,l)=>t.$emit("header-click",i,l)),onHeaderContextmenu:e[11]||(e[11]=(i,l)=>t.$emit("header-contextmenu",i,l)),onSortChange:e[12]||(e[12]=(i,l,r)=>t.$emit("sort-change",i,l,r)),onFilterChange:e[13]||(e[13]=i=>t.$emit("filter-change",i)),onCurrentChange:e[14]||(e[14]=(i,l)=>t.$emit("current-change",i,l)),onHeaderDragend:e[15]||(e[15]=(i,l,r,o)=>t.$emit("header-dragend",i,l,r,o)),onExpandChange:e[16]||(e[16]=(i,l)=>t.$emit("expand-change",i,l))}),{append:u(()=>[D(t.$slots,"append")]),default:u(()=>[n.selectionNode&&n.selectionNode.type==="selection"?(m(),g(P,R(p({key:0},n.selectionNode)),null,16)):h("",!0),(m(!0),w(v,null,S(d.columnsData,(i,l)=>(m(),g(k,{column:i},N({_:2},[S(Object.keys(t.$scopedSlots),r=>({name:"slotName",fn:u(o=>[D(t.$slots,r,{column:o.column,row:o.row,prop:o.prop})])}))]),1032,["column"]))),256))]),_:3},16,["data"]),d.showPagination?(m(),g(O,{key:0,"page-size":n.queryParamFinnal.pageSize,"current-page":n.queryParamFinnal.p,"total-count":n.totalCount,"total-page":n.totalPage,onCurrentChange:d.handleCurrentChange},null,8,["page-size","current-page","total-count","total-page","onCurrentChange"])):h("",!0),c(A,p({modelValue:n.dialogVisible,"onUpdate:modelValue":e[18]||(e[18]=i=>n.dialogVisible=i)},Object.assign({title:"\u8BE6\u60C5",width:"800px","close-on-click-modal":!1,"append-to-body":!0},a.dialogAttribute),{onClose:d.handleCloseDialog}),{footer:u(()=>[L("div",null,[c(b,{type:"primary",onClick:d.save},{default:u(()=>[K]),_:1},8,["onClick"]),c(b,{onClick:e[17]||(e[17]=i=>n.dialogVisible=!1)},{default:u(()=>[B]),_:1})])]),default:u(()=>[n.dialogVisible?(m(),g(j,{key:0,ref:"editForm",model:d.modelData,default:n.editForm,action:n.editScope,formAttribute:a.formAttribute},null,8,["model","default","action","formAttribute"])):h("",!0)]),_:1},16,["modelValue","onClose"])])}var T=V(E,[["render",U]]);export{T as default};
