import{_ as E,C as O,d as M,r,A as w,B as h,o as c,c as p,e as o,w as a,k as L,a as R,l as i,g as y,t as j,F as H,h as K}from"./index.bb69c137.js";import{a as G,r as J,b as Q,e as W,c as X,l as Y}from"./account.0712e50a.js";import{l as Z}from"./role.332ea40f.js";const $={components:{OrgPicker:O(()=>R(()=>import("./OrgPicker.13786c66.js"),["assets/OrgPicker.13786c66.js","assets/OrgPicker.c3bbba85.css","assets/index.bb69c137.js","assets/index.9545d33c.css","assets/org.19c861cf.js"]))},data(){return{account:G,dialogVisible:!1,loading:!1,list:[],editForm:{id:"",accountNumber:"",accountName:"",password:"",roles:[],state:1},queryParam:{pageSize:10,p:1,accountNumber:"",accountName:""},totalCount:0,totalPage:0,rules:{accountNumber:[{required:!0,message:"\u8BF7\u8F93\u5165\u8D26\u53F7",trigger:"blur"}],accountName:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"}],password:[{validator:(u,f,t)=>{f?(this.editForm.checkPass!==""&&this.$refs.editForm.validateField("checkPass"),t()):t(new Error("\u8BF7\u8F93\u5165\u5BC6\u7801"))},trigger:"blur"}],checkPass:[{validator:(u,f,t)=>{f?f!==this.editForm.password?t(new Error("\u4E24\u6B21\u8F93\u5165\u5BC6\u7801\u4E0D\u4E00\u81F4!")):t():t(new Error("\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801"))},trigger:"blur"}],orgId:[{required:!0,message:"\u8BF7\u9009\u62E9\u6240\u5C5E\u7EC4\u7EC7"}]},requestRoles:Z}},methods:{resetSearch(){this.queryParam={pageSize:10,p:1,accountNumber:"",accountName:""},this.fetchData(!0)},orgAdapter(s,e){return e.name||this.editForm.belongOrgName||s},resetPassword:function(s){if(!s)return null;this.$confirm(`\u786E\u5B9A\u91CD\u7F6E\u8D26\u53F7 ${s.accountNumber} \u7684\u5BC6\u7801?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{this.loading=!0,J({id:s.id}).then(e=>{e.data.password?this.$clipboard(e.data.password).then(()=>{this.$alert(`\u65B0\u5BC6\u7801\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F\uFF0C\u8BF7\u4FDD\u7BA1\u597D\u65B0\u5BC6\u7801\uFF1A<code>${e.data.password}</code>`,{confirmButtonText:"\u6211\u77E5\u9053\u4E86",dangerouslyUseHTMLString:!0}).then(()=>{this.fetchData()})}).catch(()=>{this.$alert(`\u5BC6\u7801\u5DF2\u91CD\u7F6E\uFF0C\u8BF7\u7262\u8BB0\u65B0\u5BC6\u7801\uFF1A<code>${e.data.password}</code>`,{confirmButtonText:"\u6211\u77E5\u9053\u4E86",dangerouslyUseHTMLString:!0}).then(()=>{this.fetchData()})}):this.$message.warning("\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}).catch(()=>{this.loading=!1})})},edit:function(s){const e=Object.assign({},s);e.roles=Array.isArray(e.roles)?e.roles.map(u=>u.roleId):[],this.editForm=e,this.dialogVisible=!0},save(){this.$refs.editForm.validate(s=>{if(s){this.loading=!0;let e=M(this.editForm);this.handleCloseDialog(),(e.id?W:Q)(e).then(()=>{this.fetchData(),this.$message({message:"\u6DFB\u52A0\u6210\u529F",type:"success"})}).catch(()=>{this.loading=!1})}})},handleCloseDialog:function(){this.dialogVisible=!1,this.editForm={id:"",accountNumber:"",accountName:"",password:"",roles:[],state:1},this.$refs.editForm&&this.$refs.editForm.resetFields()},remove(s){if(!s)return null;this.$confirm("\u662F\u5426\u5220\u9664?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{this.loading=!0,X({id:s.id}).then(()=>{this.fetchData(),this.$message({message:"\u5220\u9664\u6210\u529F",type:"success"})}).catch(()=>{this.loading=!1})})},fetchData:function(s){s&&(this.queryParam.p=1),this.loading=!0,Y(this.queryParam).then(e=>{this.loading=!1;const u=e.data;u&&(this.list=u.list,this.totalCount=u.totalCount,this.totalPage=u.totalPage)}).catch(()=>{this.loading=!1})}},created:function(){this.fetchData()}},ee=i(" \u6DFB\u52A0 "),te=i(" \u67E5\u8BE2 "),oe=i(" \u91CD\u7F6E "),le=i(" \u5171 "),ae=i(" \u6761\u8BB0\u5F55 "),re={key:0,style:{color:"#ff4949"}},se={key:1,style:{color:"#13ce66"}},ne=i("\u7F16\u8F91"),ie=i("\u91CD\u7F6E\u5BC6\u7801"),ue=i("\u5220\u9664"),de=["src"],ce={key:1},me=i("\u786E \u5B9A"),pe=i("\u53D6 \u6D88");function fe(s,e,u,f,t,d){const P=r("plus"),v=r("el-icon"),m=r("el-button"),C=r("ToolBar"),_=r("el-input"),n=r("el-form-item"),N=r("search"),k=r("refresh"),V=r("el-form"),D=r("info-filled"),g=r("el-table-column"),q=r("el-table"),x=r("Pagination"),B=r("uploader"),S=r("input-password"),T=r("OrgPicker"),U=r("DictSelect"),A=r("el-switch"),I=r("el-dialog"),b=w("auth"),z=w("loading");return h((c(),p("div",null,[o(C,null,{default:a(()=>[h((c(),y(m,{type:"primary",onClick:e[0]||(e[0]=l=>t.dialogVisible=!0)},{default:a(()=>[o(v,null,{default:a(()=>[o(P)]),_:1}),ee]),_:1})),[[b,t.account.add]])]),_:1}),o(V,{ref:"searchForm",inline:"",model:t.queryParam},{default:a(()=>[o(n,{label:"\u8D26\u53F7"},{default:a(()=>[o(_,{modelValue:t.queryParam.accountNumber,"onUpdate:modelValue":e[1]||(e[1]=l=>t.queryParam.accountNumber=l)},null,8,["modelValue"])]),_:1}),o(n,{label:"\u7528\u6237\u540D"},{default:a(()=>[o(_,{modelValue:t.queryParam.accountName,"onUpdate:modelValue":e[2]||(e[2]=l=>t.queryParam.accountName=l)},null,8,["modelValue"])]),_:1}),o(n,null,{default:a(()=>[o(m,{type:"primary",onClick:e[3]||(e[3]=l=>d.fetchData(!0))},{default:a(()=>[o(v,null,{default:a(()=>[o(N)]),_:1}),te]),_:1}),o(m,{onClick:e[4]||(e[4]=l=>d.resetSearch())},{default:a(()=>[o(v,null,{default:a(()=>[o(k)]),_:1}),oe]),_:1})]),_:1})]),_:1},8,["model"]),L("p",null,[o(v,null,{default:a(()=>[o(D)]),_:1}),le,o(m,{type:"text"},{default:a(()=>[i(j(t.totalCount),1)]),_:1}),ae]),o(q,{data:t.list},{default:a(()=>[o(g,{prop:"accountNumber",label:"\u8D26\u53F7",align:"center"}),o(g,{prop:"accountName",label:"\u7528\u6237\u540D",align:"center"}),o(g,{prop:"roleName",label:"\u89D2\u8272",align:"center"}),o(g,{label:"\u72B6\u6001",width:"80",align:"center"},{default:a(l=>[l.row.state?(c(),p("span",se,"\u5DF2\u542F\u7528")):(c(),p("span",re,"\u5DF2\u7981\u7528"))]),_:1}),o(g,{label:"\u64CD\u4F5C",width:"300",align:"center"},{default:a(l=>[h((c(),y(m,{onClick:F=>d.edit(l.row)},{default:a(()=>[ne]),_:2},1032,["onClick"])),[[b,t.account.edit]]),h((c(),y(m,{type:"warning",plain:"",onClick:F=>d.resetPassword(l.row)},{default:a(()=>[ie]),_:2},1032,["onClick"])),[[b,t.account.resetPassword]]),h((c(),y(m,{type:"danger",plain:"",onClick:F=>d.remove(l.row)},{default:a(()=>[ue]),_:2},1032,["onClick"])),[[b,t.account.remove]])]),_:1})]),_:1},8,["data"]),o(x,{"page-size":t.queryParam.pageSize,"current-page":t.queryParam.p,"total-count":t.totalCount,"total-page":t.totalPage,onCurrentChange:e[5]||(e[5]=l=>{t.queryParam.p=l,d.fetchData()}),onSizeChange:e[6]||(e[6]=l=>{t.queryParam.pageSize=l,d.fetchData(!0)})},null,8,["page-size","current-page","total-count","total-page"]),o(I,{"custom-class":"userEditDialog","close-on-click-modal":!1,title:"\u8D26\u53F7\u4FE1\u606F",modelValue:t.dialogVisible,"onUpdate:modelValue":e[16]||(e[16]=l=>t.dialogVisible=l),width:"600px","destroy-on-close":"",onClose:d.handleCloseDialog},{footer:a(()=>[o(m,{type:"primary",onClick:d.save},{default:a(()=>[me]),_:1},8,["onClick"]),o(m,{onClick:e[15]||(e[15]=l=>t.dialogVisible=!1)},{default:a(()=>[pe]),_:1})]),default:a(()=>[o(V,{ref:"editForm",rules:t.rules,model:t.editForm,"label-width":"80px"},{default:a(()=>[o(n,{label:"\u5934\u50CF",prop:"avatar"},{default:a(()=>[o(B,{class:"upload_avatar",accept:"t-image",modelValue:t.editForm.avatar?[{url:t.editForm.avatar}]:[],imgCrop:"","show-file-list":!1,"on-success":l=>{t.editForm.avatar=l.url}},{default:a(()=>[t.editForm.avatar?(c(),p("img",{key:0,src:t.editForm.avatar,alt:""},null,8,de)):(c(),p("span",ce,"\u4E0A\u4F20\u5934\u50CF"))]),_:1},8,["modelValue","on-success"])]),_:1}),o(n,{label:"\u8D26\u53F7",prop:"accountNumber"},{default:a(()=>[o(_,{modelValue:t.editForm.accountNumber,"onUpdate:modelValue":e[7]||(e[7]=l=>t.editForm.accountNumber=l),modelModifiers:{trim:!0},maxlength:100},null,8,["modelValue"])]),_:1}),o(n,{label:"\u7528\u6237\u540D",prop:"accountName"},{default:a(()=>[o(_,{modelValue:t.editForm.accountName,"onUpdate:modelValue":e[8]||(e[8]=l=>t.editForm.accountName=l),modelModifiers:{trim:!0},maxlength:100},null,8,["modelValue"])]),_:1}),t.editForm.id?K("",!0):(c(),p(H,{key:0},[o(n,{label:"\u5BC6\u7801",prop:"password"},{default:a(()=>[o(S,{modelValue:t.editForm.password,"onUpdate:modelValue":e[9]||(e[9]=l=>t.editForm.password=l),autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(n,{label:"\u786E\u8BA4\u5BC6\u7801",prop:"checkPass"},{default:a(()=>[o(_,{type:"password",modelValue:t.editForm.checkPass,"onUpdate:modelValue":e[10]||(e[10]=l=>t.editForm.checkPass=l),autocomplete:"off"},null,8,["modelValue"])]),_:1})],64)),o(n,{label:"\u6240\u5C5E\u7EC4\u7EC7",prop:"orgId"},{default:a(()=>[o(T,{modelValue:t.editForm.orgId,"onUpdate:modelValue":e[11]||(e[11]=l=>t.editForm.orgId=l),adapter:d.orgAdapter,onChange:e[12]||(e[12]=l=>s.$refs.editForm.validateField("orgId"))},null,8,["modelValue","adapter"])]),_:1}),o(n,{label:"\u89D2\u8272"},{default:a(()=>[o(U,{modelValue:t.editForm.roleId,"onUpdate:modelValue":e[13]||(e[13]=l=>t.editForm.roleId=l),request:t.requestRoles,labelKey:"name"},null,8,["modelValue","request"])]),_:1}),o(n,{label:"\u72B6\u6001"},{default:a(()=>[o(A,{modelValue:t.editForm.state,"onUpdate:modelValue":e[14]||(e[14]=l=>t.editForm.state=l),"active-text":"\u542F\u7528","inactive-text":"\u7981\u7528","active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","onClose"])])),[[z,t.loading]])}var ve=E($,[["render",fe],["__scopeId","data-v-2d844efa"]]);export{ve as default};
