import{d as e,a,_ as t}from"./index.3253e0ab.js";import{a as l,r as o,b as r,e as i,c as s,l as d}from"./account.7a6c22ae.js";import{l as n}from"./role.55f69842.js";import{q as u,r as c,aU as m,aV as p,o as g,t as h,b as f,w as b,v as _,ax as V,a as y,ay as F,aA as w,aC as P}from"./ui.9933098f.js";const k={components:{OrgPicker:u((()=>a((()=>import("./OrgPicker.f5821f10.js")),["assets/OrgPicker.f5821f10.js","assets/index.3253e0ab.js","assets/ui.9933098f.js","assets/index.58490702.css","assets/org.885c46e3.js","assets/OrgPicker.f4e7923d.css"])))},data(){return{account:l,dialogVisible:!1,loading:!1,list:[],editForm:{id:"",accountNumber:"",accountName:"",password:"",roles:[],state:1},queryParam:{pageSize:20,p:1,accountNumber:"",accountName:""},totalCount:0,totalPage:0,rules:{accountNumber:[{required:!0,message:"请输入账号",trigger:"blur"}],accountName:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{validator:(e,a,t)=>{a?(""!==this.editForm.checkPass&&this.$refs.editForm.validateField("checkPass"),t()):t(new Error("请输入密码"))},trigger:"blur"}],checkPass:[{validator:(e,a,t)=>{a?a!==this.editForm.password?t(new Error("两次输入密码不一致!")):t():t(new Error("请再次输入密码"))},trigger:"blur"}],orgId:[{required:!0,message:"请选择所属组织"}]},requestRoles:n}},methods:{resetSearch(){this.queryParam={pageSize:20,p:1,accountNumber:"",accountName:""},this.fetchData(!0)},orgAdapter(e){return this.editForm.belongOrgName||e},resetPassword:function(e){if(!e)return null;this.$confirm(`确定重置账号 ${e.accountNumber} 的密码?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.loading=!0,o({id:e.id}).then((e=>{e.data.password?this.$clipboard(e.data.password).then((()=>{this.$alert(`新密码已复制到剪贴板，请保管好新密码：<code>${e.data.password}</code>`,{confirmButtonText:"我知道了",dangerouslyUseHTMLString:!0}).then((()=>{this.fetchData()}))})).catch((()=>{this.$alert(`密码已重置，请牢记新密码：<code>${e.data.password}</code>`,{confirmButtonText:"我知道了",dangerouslyUseHTMLString:!0}).then((()=>{this.fetchData()}))})):this.$message.warning("操作失败，请重试")})).catch((()=>{this.loading=!1}))}))},edit:function(e){const a=Object.assign({},e);a.roles=Array.isArray(a.roles)?a.roles.map((e=>e.roleId)):[],this.editForm=a,this.dialogVisible=!0},save(){this.$refs.editForm.validate((a=>{if(a){this.loading=!0;let a=e(this.editForm);this.handleCloseDialog(),(a.id?i:r)(a).then((()=>{this.fetchData(),this.$message({message:"添加成功",type:"success"})})).catch((()=>{this.loading=!1}))}}))},handleCloseDialog:function(){this.dialogVisible=!1,this.editForm={id:"",accountNumber:"",accountName:"",password:"",roles:[],state:1},this.$refs.editForm&&this.$refs.editForm.resetFields()},remove(e){if(!e)return null;this.$confirm("是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.loading=!0,s({id:e.id}).then((()=>{this.fetchData(),this.$message({message:"删除成功",type:"success"})})).catch((()=>{this.loading=!1}))}))},fetchData:function(e){e&&(this.queryParam.p=1),this.loading=!0,d(this.queryParam).then((e=>{this.loading=!1;const a=e.data;a&&(this.list=a.list,this.totalCount=a.totalCount,this.totalPage=a.totalPage)})).catch((()=>{this.loading=!1}))}},created:function(){this.fetchData()}},v={class:"flex-col"},C={class:"flex-1 scrollbar"},N={key:0,style:{color:"#ff4949"}},q={key:1,style:{color:"#13ce66"}},x=["src"],D={key:1};const $=t(k,[["render",function(e,a,t,l,o,r){const i=c("plus"),s=c("el-icon"),d=c("el-button"),n=c("ToolBar"),u=c("el-input"),k=c("el-form-item"),$=c("search"),U=c("refresh"),I=c("el-form"),S=c("info-filled"),T=c("el-link"),z=c("el-table-column"),B=c("el-table"),O=c("Pagination"),j=c("uploader"),A=c("input-password"),E=c("OrgPicker"),M=c("DictSelect"),L=c("el-switch"),R=c("el-dialog"),H=m("auth"),K=m("loading");return p((g(),h("div",v,[f(n,null,{default:b((()=>[p((g(),y(d,{type:"primary",onClick:a[0]||(a[0]=e=>o.dialogVisible=!0)},{default:b((()=>[f(s,null,{default:b((()=>[f(i)])),_:1}),V(" 添加 ")])),_:1})),[[H,o.account.add]])])),_:1}),_("div",C,[f(I,{ref:"searchForm",inline:"",model:o.queryParam},{default:b((()=>[f(k,{label:"账号"},{default:b((()=>[f(u,{modelValue:o.queryParam.accountNumber,"onUpdate:modelValue":a[1]||(a[1]=e=>o.queryParam.accountNumber=e)},null,8,["modelValue"])])),_:1}),f(k,{label:"用户名"},{default:b((()=>[f(u,{modelValue:o.queryParam.accountName,"onUpdate:modelValue":a[2]||(a[2]=e=>o.queryParam.accountName=e)},null,8,["modelValue"])])),_:1}),f(k,null,{default:b((()=>[f(d,{type:"primary",onClick:a[3]||(a[3]=e=>r.fetchData(!0))},{default:b((()=>[f(s,null,{default:b((()=>[f($)])),_:1}),V(" 查询 ")])),_:1}),f(d,{onClick:a[4]||(a[4]=e=>r.resetSearch())},{default:b((()=>[f(s,null,{default:b((()=>[f(U)])),_:1}),V(" 重置 ")])),_:1})])),_:1})])),_:1},8,["model"]),_("p",null,[f(s,null,{default:b((()=>[f(S)])),_:1}),V(" 共 "),f(T,null,{default:b((()=>[V(F(o.totalCount),1)])),_:1}),V(" 条记录 ")]),f(B,{data:o.list},{default:b((()=>[f(z,{prop:"accountNumber",label:"账号",align:"center"}),f(z,{prop:"accountName",label:"用户名",align:"center"}),f(z,{prop:"roleName",label:"角色",align:"center"}),f(z,{label:"状态",width:"80",align:"center"},{default:b((e=>[e.row.state?(g(),h("span",q,"已启用")):(g(),h("span",N,"已禁用"))])),_:1}),f(z,{label:"操作",width:"300",align:"center"},{default:b((e=>[p((g(),y(d,{onClick:a=>r.edit(e.row)},{default:b((()=>[V("编辑")])),_:2},1032,["onClick"])),[[H,o.account.edit]]),p((g(),y(d,{type:"warning",plain:"",onClick:a=>r.resetPassword(e.row)},{default:b((()=>[V("重置密码")])),_:2},1032,["onClick"])),[[H,o.account.resetPassword]]),p((g(),y(d,{type:"danger",plain:"",onClick:a=>r.remove(e.row)},{default:b((()=>[V("删除")])),_:2},1032,["onClick"])),[[H,o.account.remove]])])),_:1})])),_:1},8,["data"])]),f(O,{"page-size":o.queryParam.pageSize,"current-page":o.queryParam.p,"total-count":o.totalCount,"total-page":o.totalPage,onCurrentChange:a[5]||(a[5]=e=>{o.queryParam.p=e,r.fetchData()}),onSizeChange:a[6]||(a[6]=e=>{o.queryParam.pageSize=e,r.fetchData(!0)})},null,8,["page-size","current-page","total-count","total-page"]),f(R,{"custom-class":"userEditDialog","close-on-click-modal":!1,title:"账号信息",modelValue:o.dialogVisible,"onUpdate:modelValue":a[16]||(a[16]=e=>o.dialogVisible=e),width:"600px","destroy-on-close":"",onClose:r.handleCloseDialog},{footer:b((()=>[f(d,{type:"primary",onClick:r.save},{default:b((()=>[V("确 定")])),_:1},8,["onClick"]),f(d,{onClick:a[15]||(a[15]=e=>o.dialogVisible=!1)},{default:b((()=>[V("取 消")])),_:1})])),default:b((()=>[f(I,{ref:"editForm",rules:o.rules,model:o.editForm,"label-width":"80px"},{default:b((()=>[f(k,{label:"头像",prop:"avatar"},{default:b((()=>[f(j,{class:"upload_avatar",accept:"t-image",modelValue:o.editForm.avatar?[{url:o.editForm.avatar}]:[],imgCrop:"","show-file-list":!1,"on-success":e=>{o.editForm.avatar=e.url}},{default:b((()=>[o.editForm.avatar?(g(),h("img",{key:0,class:"upload_avatar_img",src:o.editForm.avatar,alt:""},null,8,x)):(g(),h("span",D,"上传头像"))])),_:1},8,["modelValue","on-success"])])),_:1}),f(k,{label:"账号",prop:"accountNumber"},{default:b((()=>[f(u,{modelValue:o.editForm.accountNumber,"onUpdate:modelValue":a[7]||(a[7]=e=>o.editForm.accountNumber=e),modelModifiers:{trim:!0},maxlength:100},null,8,["modelValue"])])),_:1}),f(k,{label:"用户名",prop:"accountName"},{default:b((()=>[f(u,{modelValue:o.editForm.accountName,"onUpdate:modelValue":a[8]||(a[8]=e=>o.editForm.accountName=e),modelModifiers:{trim:!0},maxlength:100},null,8,["modelValue"])])),_:1}),o.editForm.id?P("",!0):(g(),h(w,{key:0},[f(k,{label:"密码",prop:"password"},{default:b((()=>[f(A,{modelValue:o.editForm.password,"onUpdate:modelValue":a[9]||(a[9]=e=>o.editForm.password=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),f(k,{label:"确认密码",prop:"checkPass"},{default:b((()=>[f(u,{type:"password",modelValue:o.editForm.checkPass,"onUpdate:modelValue":a[10]||(a[10]=e=>o.editForm.checkPass=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})],64)),f(k,{label:"所属组织",prop:"orgId"},{default:b((()=>[f(E,{modelValue:o.editForm.orgId,"onUpdate:modelValue":[a[11]||(a[11]=e=>o.editForm.orgId=e),a[12]||(a[12]=(a,t)=>{o.editForm.belongOrgName=t.name,e.$refs.editForm.validateField("orgId")})],adapter:r.orgAdapter},null,8,["modelValue","adapter"])])),_:1}),f(k,{label:"角色"},{default:b((()=>[f(M,{modelValue:o.editForm.roleId,"onUpdate:modelValue":a[13]||(a[13]=e=>o.editForm.roleId=e),request:o.requestRoles,labelKey:"name"},null,8,["modelValue","request"])])),_:1}),f(k,{label:"状态"},{default:b((()=>[f(L,{modelValue:o.editForm.state,"onUpdate:modelValue":a[14]||(a[14]=e=>o.editForm.state=e),"active-text":"启用","inactive-text":"禁用","active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue","onClose"])])),[[K,o.loading]])}],["__scopeId","data-v-ee1416f7"]]);export{$ as default};
