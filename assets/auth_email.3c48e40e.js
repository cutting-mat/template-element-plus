import{e as h,a as g}from"./auth.fb89abed.js";import{_ as E,r as n,o as v,h as V,w as a,e as l,k as d,t as w}from"./index.325e0c38.js";const C={data(){return{loading:!1,formData:{id:null,userInput:null,inputEmail:null},rules:{inputEmail:[{validator:(e,s,i)=>{s?(this.userEmail!==s&&i(new Error("\u90AE\u7BB1\u4E0D\u6B63\u786E")),i()):i(new Error("\u8BF7\u8F93\u5165\u5B89\u5168\u90AE\u7BB1"))}}],userInput:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",trigger:"blur"},{min:4,max:6,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9A8C\u8BC1\u7801",trigger:"blur"}]}}},computed:{userEmail(){return this.$store.state.user.email},anonymousEmail(){if(this.userEmail){const t=this.userEmail.split("@")[0].split("");return`${t.map((s,i)=>i===0||i===t.length-1?s:"*").join("")}@${this.userEmail.split("@")[1]}`}return""}},methods:{sendValidCode(){this.$refs.form.validateField("inputEmail",t=>{t&&(this.loading=!0,h({email:this.formData.inputEmail}).then(e=>{this.loading=!1,e.status===200?(this.formData.id=e.data.id,this.$refs.countdownButton.start()):this.$message.warning("\u9A8C\u8BC1\u90AE\u4EF6\u53D1\u9001\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5")}).catch(()=>{this.loading=!1}))})},handleSubmit(){this.$refs.form.validateField("userInput",t=>{t&&(this.loading=!0,g(this.formData).then(e=>{this.loading=!1,e.status===200?this.$emit("success",e.data):(this.$refs.form.resetFields(),this.$message.warning("\u9A8C\u8BC1\u5931\u8D25"))}).catch(()=>{this.loading=!1}))})}}},D=d(" \u83B7\u53D6\u9A8C\u8BC1\u7801 "),y=d("\u7ACB\u5373\u9A8C\u8BC1");function x(t,e,s,i,o,u){const r=n("el-form-item"),f=n("el-input"),p=n("countdownButton"),_=n("el-button"),c=n("el-form");return v(),V(c,{ref:"form",model:o.formData,rules:o.rules,"label-position":"left",class:"auth_email","v-loading":o.loading},{default:a(()=>[l(r,null,{default:a(()=>[d("\u5B89\u5168\u90AE\u7BB1\uFF1A"+w(u.anonymousEmail),1)]),_:1}),l(r,{prop:"inputEmail"},{default:a(()=>[l(f,{modelValue:o.formData.inputEmail,"onUpdate:modelValue":e[0]||(e[0]=m=>o.formData.inputEmail=m),placeholder:"\u8BF7\u8F93\u5165\u5B89\u5168\u90AE\u7BB1","prefix-icon":"message",size:"large"},null,8,["modelValue"])]),_:1}),l(r,{prop:"userInput"},{default:a(()=>[l(f,{modelValue:o.formData.userInput,"onUpdate:modelValue":e[1]||(e[1]=m=>o.formData.userInput=m),placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",size:"large"},{append:a(()=>[l(p,{ref:"countdownButton",count:30,onClick:u.sendValidCode},{default:a(()=>[D]),_:1},8,["onClick"])]),_:1},8,["modelValue"])]),_:1}),l(r,null,{default:a(()=>[l(_,{"native-type":"button",type:"primary",style:{width:"100%"},onClick:u.handleSubmit},{default:a(()=>[y]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules","v-loading"])}var B=E(C,[["render",x],["__scopeId","data-v-24dc0322"]]);export{B as default};
