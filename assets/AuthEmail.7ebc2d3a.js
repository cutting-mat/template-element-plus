import{k as t,m as a,_ as e}from"./index.3253e0ab.js";import{r as i,o as l,a as s,w as n,ax as r,ay as u,aC as o,b as d,aR as m}from"./ui.9933098f.js";const f=e({name:"AuthEmail",emits:["success"],data(){return{loading:!1,formData:{id:null,userInput:null,inputEmail:null},rules:{inputEmail:[{validator:(t,a,e)=>{if(a){if(this.userEmail&&this.userEmail!==a)return e(new Error("邮箱不正确"));e()}else e(new Error("请输入安全邮箱"))},trigger:[]}],userInput:[{required:!0,message:"请输入验证码",trigger:"blur"},{min:4,max:6,message:"请输入正确的验证码",trigger:"blur"}]},buttonDisabled:!1}},computed:{userEmail(){return this.$store.user.email||""},anonymousEmail(){if(this.userEmail){const t=this.userEmail.split("@")[0].split("");return`${t.map(((a,e)=>0===e||e===t.length-1?a:"*")).join("")}@${this.userEmail.split("@")[1]}`}return""}},methods:{sendValidCode(){this.$refs.form.validateField("inputEmail",(a=>{a||(this.loading=!0,t({email:this.formData.inputEmail}).then((t=>{this.loading=!1,200===t.status?(this.formData.id=t.data.id,this.$refs.countdownButton.start()):this.$message.warning("验证邮件发送失败，请稍后重试")})).catch((()=>{this.loading=!1})))}))},handleSubmit(){this.$refs.form.validateField("userInput",(t=>{t||(this.loading=!0,a(this.formData).then((t=>{this.loading=!1,200===t.status?this.$emit("success",t.data):(this.$refs.form.resetFields(),this.$message.warning("验证失败"))})).catch((()=>{this.loading=!1})))}))}}},[["render",function(t,a,e,f,p,h){const g=i("el-form-item"),c=i("Message"),b=i("el-icon"),E=i("el-input"),D=i("CountDown"),_=i("el-button"),$=i("el-form");return l(),s($,{ref:"form",model:p.formData,rules:p.rules,"label-position":"left",class:"auth_email","v-loading":p.loading,onSubmit:m(h.handleSubmit,["prevent"])},{default:n((()=>[h.anonymousEmail?(l(),s(g,{key:0},{default:n((()=>[r("安全邮箱："+u(h.anonymousEmail),1)])),_:1})):o("",!0),d(g,{prop:"inputEmail"},{default:n((()=>[d(E,{modelValue:p.formData.inputEmail,"onUpdate:modelValue":a[0]||(a[0]=t=>p.formData.inputEmail=t),placeholder:"请输入安全邮箱"},{prefix:n((()=>[d(b,null,{default:n((()=>[d(c)])),_:1})])),_:1},8,["modelValue"])])),_:1}),d(g,{prop:"userInput"},{default:n((()=>[d(E,{modelValue:p.formData.userInput,"onUpdate:modelValue":a[3]||(a[3]=t=>p.formData.userInput=t),placeholder:"请输入验证码"},{append:n((()=>[d(_,{disabled:p.buttonDisabled,onClick:h.sendValidCode},{default:n((()=>[d(D,{ref:"countdownButton",count:30,onStart:a[1]||(a[1]=t=>p.buttonDisabled=!0),onEnd:a[2]||(a[2]=t=>p.buttonDisabled=!1)},{default:n((()=>[r(" 获取验证码 ")])),_:1},512)])),_:1},8,["disabled","onClick"])])),_:1},8,["modelValue"])])),_:1}),d(g,null,{default:n((()=>[d(_,{"native-type":"submit",type:"primary",style:{width:"100%"}},{default:n((()=>[r(" 立即验证 ")])),_:1})])),_:1})])),_:1},8,["model","rules","v-loading","onSubmit"])}]]);export{f as default};
