import{_ as t,k as a,m as e}from"./index.e5690914.js";import{r as i,o as s,a as l,w as n,ax as r,ay as u,aC as o,b as d,aU as m}from"./ui.7155d707.js";const f={name:"AuthEmail",emits:["success"],data(){return{loading:!1,formData:{id:null,userInput:null,inputEmail:null},rules:{inputEmail:[{validator:(t,a,e)=>{if(a){if(this.userEmail&&this.userEmail!==a)return e(new Error("邮箱不正确"));e()}else e(new Error("请输入安全邮箱"))},trigger:[]}],userInput:[{required:!0,message:"请输入验证码",trigger:"blur"},{min:4,max:6,message:"请输入正确的验证码",trigger:"blur"}]},buttonDisabled:!1}},computed:{userEmail(){return this.$store.user.email||""},anonymousEmail(){if(this.userEmail){const t=this.userEmail.split("@")[0].split("");return`${t.map(((a,e)=>0===e||e===t.length-1?a:"*")).join("")}@${this.userEmail.split("@")[1]}`}return""}},methods:{sendValidCode(){this.$refs.form.validateField("inputEmail",(t=>{t||(this.loading=!0,a({email:this.formData.inputEmail}).then((t=>{this.loading=!1,200===t.status?(this.formData.id=t.data.id,this.$refs.countdownButton.start()):this.$message.warning("验证邮件发送失败，请稍后重试")})).catch((()=>{this.loading=!1})))}))},handleSubmit(){this.$refs.form.validateField("userInput",(t=>{t||(this.loading=!0,e(this.formData).then((t=>{this.loading=!1,200===t.status?this.$emit("success",t.data):(this.$refs.form.resetFields(),this.$message.warning("验证失败"))})).catch((()=>{this.loading=!1})))}))}}},p=r(" 获取验证码 "),h=r(" 立即验证 ");const g=t(f,[["render",function(t,a,e,f,g,c){const b=i("el-form-item"),E=i("Message"),D=i("el-icon"),_=i("el-input"),$=i("CountDown"),w=i("el-button"),y=i("el-form");return s(),l(y,{ref:"form",model:g.formData,rules:g.rules,"label-position":"left",class:"auth_email","v-loading":g.loading,onSubmit:m(c.handleSubmit,["prevent"])},{default:n((()=>[c.anonymousEmail?(s(),l(b,{key:0},{default:n((()=>[r("安全邮箱："+u(c.anonymousEmail),1)])),_:1})):o("",!0),d(b,{prop:"inputEmail"},{default:n((()=>[d(_,{modelValue:g.formData.inputEmail,"onUpdate:modelValue":a[0]||(a[0]=t=>g.formData.inputEmail=t),placeholder:"请输入安全邮箱"},{prefix:n((()=>[d(D,null,{default:n((()=>[d(E)])),_:1})])),_:1},8,["modelValue"])])),_:1}),d(b,{prop:"userInput"},{default:n((()=>[d(_,{modelValue:g.formData.userInput,"onUpdate:modelValue":a[3]||(a[3]=t=>g.formData.userInput=t),placeholder:"请输入验证码"},{append:n((()=>[d(w,{disabled:g.buttonDisabled,onClick:c.sendValidCode},{default:n((()=>[d($,{ref:"countdownButton",count:30,onStart:a[1]||(a[1]=t=>g.buttonDisabled=!0),onEnd:a[2]||(a[2]=t=>g.buttonDisabled=!1)},{default:n((()=>[p])),_:1},512)])),_:1},8,["disabled","onClick"])])),_:1},8,["modelValue"])])),_:1}),d(b,null,{default:n((()=>[d(w,{"native-type":"submit",type:"primary",style:{width:"100%"}},{default:n((()=>[h])),_:1})])),_:1})])),_:1},8,["model","rules","v-loading","onSubmit"])}]]);export{g as default};
