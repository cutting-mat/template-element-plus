import{_ as v,a as C,d as F,b as w,r as s,o as u,c as g,e as p,w as m,f as D,g as $,h as f,n as L,m as h,i as b,F as P,j as S,k}from"./index.325e0c38.js";const N={props:{api:{type:Object,required:!0},model:{type:Object,required:!0,default(){return{accountName:{type:"string",default:null,label:"\u7528\u6237\u540D",control:"el-input",controlOption:{},scope:["create","update"],required:!1,validator:null,message:null,asynValid:!1}}}},columns:{type:Array,required:!0,default(){return[{hidden:!1,slotName:""}]}},dataKey:{type:String,required:!1,default:"id"},immediate:{type:Boolean,required:!1,default:!0},queryParam:{type:Object,required:!1,default(){return{}}},getItemFromDetaiApi:{type:Boolean,required:!1,default:!1},tableAttribute:{type:Object,required:!1,default(){return{}}},dialogAttribute:{type:Object,required:!1,default(){return{}}},formAttribute:{type:Object,required:!1,default(){return{}}}},filters:{formatterFilter(e,t,a,c,r){return typeof r=="function"?r(t,a,e,c):e}},components:{CURDForm:()=>C(()=>import("./CURDForm.a81d6f34.js"),["assets/CURDForm.a81d6f34.js","assets/index.325e0c38.js","assets/index.427412f4.css"]),CURDColumn:()=>C(()=>import("./CURDColumn.6cae6807.js"),["assets/CURDColumn.6cae6807.js","assets/index.325e0c38.js","assets/index.427412f4.css"])},data(){return{dialogVisible:!1,loading:!1,list:[],editForm:{},editScope:"",queryParamFinnal:{p:1,pageSize:10},totalCount:0,totalPage:0,selectionNode:null,table:{clearSelection:()=>this.$refs.table.clearSelection(),toggleRowSelection:(e,t)=>this.$refs.table.toggleRowSelection(e,t),toggleAllSelection:()=>this.$refs.table.toggleAllSelection(),toggleRowExpansion:(e,t)=>this.$refs.table.toggleRowExpansion(e,t),setCurrentRow:e=>this.$refs.table.setCurrentRow(e),clearSort:()=>this.$refs.table.clearSort(),clearFilter:e=>this.$refs.table.clearFilter(e),doLayout:()=>this.$refs.table.doLayout(),sort:(e,t)=>this.$refs.table.clearFilter(e,t)},form:{validate:e=>this.$refs.editForm.validate(e),validateField:(e,t)=>this.$refs.editForm.validateField(e,t),resetFields:()=>this.$refs.editForm.resetFields(),clearValidate:()=>this.$refs.editForm.clearValidate()}}},computed:{showPagination(){return this.list.length&&this.totalCount&&this.totalPage},modelKey(){return Object.keys(this.model)},modelData(){let e=Object.assign({},this.model);return this.modelKey.forEach(t=>{let a=Object.assign({},e[t]);e[t]=Object.assign({type:"string",default:{array:[],object:{}}[a.type]||null,control:{boolean:"el-switch",array:"DictCheckbox"}[a.type]||"el-input",scope:["create","update"],required:!!a.required},a),a.control==="el-input"&&(a.controlOption=Object.assign({maxlength:100},a.controlOption))}),e},modelValue(){let e={};return this.modelKey.map(t=>{e[t]=this.modelData[t].default}),e},columnsData(){return this.columns.filter(e=>e.type==="selection"?(this.selectionNode=Object.assign({},e),!1):!e.hidden).map(e=>{let t=Object.assign({align:"center"},e);return(t.type==="selection"||t.type==="expand")&&console.warn('BaseCURD\u7EC4\u4EF6\uFF1Acolumns=>type\u5C5E\u6027\u53EA\u652F\u6301"default"\u548C"index"'),t})}},watch:{loading(){this.$emit("loading-state",this.loading)}},methods:{handleCurrentChange:function(e){this.queryParamFinnal.p=e,this.fetchList()},create(){this.editForm=Object.assign({},this.modelValue),this.editScope="create",this.dialogVisible=!0},update:async function(e){this.editForm=this.getItemFromDetaiApi?await this.fetchDetail(e[this.dataKey]):F(e),this.editScope="update",this.dialogVisible=!0},save(){this.$refs.editForm.validate(e=>{if(e){let t=F(this.editForm);this.handleCloseDialog();let a=this.api[this.editScope];if(typeof a!="function")return console.warn(`api.${this.editScope}()\u672A\u5B9A\u4E49`);this.loading=!0,a(t).then(c=>{c.status===200?(this.$message({message:"\u64CD\u4F5C\u6210\u529F",type:"success"}),this.fetchList()):this.$message({message:"\u64CD\u4F5C\u5931\u8D25",type:"warning"})}).catch(()=>{this.loading=!1})}})},delete(e){if(!e||!e[this.dataKey])return console.warn(`api.delete(): \u53C2\u6570${this.dataKey}\u65E0\u6548`);this.$confirm("\u662F\u5426\u5220\u9664?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{this.loading=!0,this.api.delete({[this.dataKey]:e[this.dataKey]}).then(t=>{t.status===200?(this.fetchList(),this.$message({message:"\u5220\u9664\u6210\u529F",type:"success"})):this.$message({message:"\u5220\u9664\u5931\u8D25",type:"warning"})}).catch(()=>{this.loading=!1})}).catch(()=>{})},handleCloseDialog:function(){this.dialogVisible=!1,this.editForm=Object.assign({},this.modelValue)},fetchDetail:function(e){return e?(this.loading=!0,this.api.detail({[this.dataKey]:e}).then(t=>(this.loading=!1,t.data)).catch(()=>{this.loading=!1})):console.warn(`api.detail(): \u53C2\u6570${this.dataKey}\u65E0\u6548`)},fetchList:function(e){e&&(this.queryParamFinnal.p=1),this.loading=!0,this.api.list(this.queryParamFinnal).then(t=>{this.loading=!1;const a=t.data;Array.isArray(a)?this.list=w(a):Array.isArray(a.list)&&(this.list=w(a.list),this.totalCount=a.totalCount,this.totalPage=a.totalPage)}).catch(()=>{this.loading=!1})},search(){Object.assign(this.queryParamFinnal,this.queryParam,{p:this.queryParamFinnal.p,pageSize:this.queryParamFinnal.pageSize}),this.fetchList(!0)}},created(){let e=["list","detail","create","update","delete"].filter(t=>typeof this.api[t]!="function");e.length&&console.warn(`${e.map(t=>"api."+t+"()").join("\u3001")}\u672A\u5B9A\u4E49`),this.immediate&&this.search()}},E={slot:"append"},K={class:"dialog-footer"},B=k("\u786E \u5B9A"),U=k("\u53D6 \u6D88");function z(e,t,a,c,r,d){const q=s("el-table-column"),O=s("CURDColumn"),j=s("el-table"),A=s("Pagination"),V=s("CURDForm"),y=s("el-button"),R=s("el-dialog");return u(),g("div",null,[p(j,h({ref:"table",data:r.list},Object.assign({border:!0,"default-expand-all":!0,"row-key":"id"},a.tableAttribute),{onSelect:t[0]||(t[0]=(i,l)=>e.$emit("select",i,l)),onSelectAll:t[1]||(t[1]=i=>e.$emit("select-all",i)),onSelectionChange:t[2]||(t[2]=i=>e.$emit("selection-change",i)),onCellMouseEnter:t[3]||(t[3]=(i,l,o,n)=>e.$emit("cell-mouse-enter",i,l,o,n)),onCellMouseLeave:t[4]||(t[4]=(i,l,o,n)=>e.$emit("cell-mouse-leave",i,l,o,n)),onCellClick:t[5]||(t[5]=(i,l,o,n)=>e.$emit("cell-click",i,l,o,n)),onCellDblclick:t[6]||(t[6]=(i,l,o,n)=>e.$emit("cell-dblclick",i,l,o,n)),onRowClick:t[7]||(t[7]=(i,l,o)=>e.$emit("row-click",i,l,o)),onRowContextmenu:t[8]||(t[8]=(i,l,o)=>e.$emit("row-click",i,l,o)),onRowDblclick:t[9]||(t[9]=(i,l,o)=>e.$emit("row-dblclick",i,l,o)),onHeaderClick:t[10]||(t[10]=(i,l)=>e.$emit("header-click",i,l)),onHeaderContextmenu:t[11]||(t[11]=(i,l)=>e.$emit("header-contextmenu",i,l)),onSortChange:t[12]||(t[12]=(i,l,o)=>e.$emit("sort-change",i,l,o)),onFilterChange:t[13]||(t[13]=i=>e.$emit("filter-change",i)),onCurrentChange:t[14]||(t[14]=(i,l)=>e.$emit("current-change",i,l)),onHeaderDragend:t[15]||(t[15]=(i,l,o,n)=>e.$emit("header-dragend",i,l,o,n)),onExpandChange:t[16]||(t[16]=(i,l)=>e.$emit("expand-change",i,l))}),{default:m(()=>[D("template",E,[$(e.$slots,"append")]),r.selectionNode&&r.selectionNode.type==="selection"?(u(),f(q,L(h({key:0},r.selectionNode)),null,16)):b("",!0),(u(!0),g(P,null,S(d.columnsData,(i,l)=>(u(),f(O,{column:i},{default:m(()=>[(u(!0),g(P,null,S(Object.keys(e.$scopedSlots),o=>$(e.$slots,o,{column:e.scope.column,row:e.scope.row,prop:e.scope.prop})),256))]),_:2},1032,["column"]))),256))]),_:3},16,["data"]),d.showPagination?(u(),f(A,{key:0,"page-size":r.queryParamFinnal.pageSize,"current-page":r.queryParamFinnal.p,"total-count":r.totalCount,"total-page":r.totalPage,onCurrentChange:d.handleCurrentChange},null,8,["page-size","current-page","total-count","total-page","onCurrentChange"])):b("",!0),p(R,h({modelValue:r.dialogVisible,"onUpdate:modelValue":t[18]||(t[18]=i=>r.dialogVisible=i)},Object.assign({title:"\u8BE6\u60C5",width:"800px","close-on-click-modal":!1,"append-to-body":!0},a.dialogAttribute),{onClose:d.handleCloseDialog}),{footer:m(()=>[D("div",K,[p(y,{type:"primary",onClick:d.save},{default:m(()=>[B]),_:1},8,["onClick"]),p(y,{onClick:t[17]||(t[17]=i=>r.dialogVisible=!1)},{default:m(()=>[U]),_:1})])]),default:m(()=>[r.dialogVisible?(u(),f(V,{key:0,ref:"editForm",model:d.modelData,default:r.editForm,action:r.editScope,formAttribute:a.formAttribute},null,8,["model","default","action","formAttribute"])):b("",!0)]),_:1},16,["modelValue","onClose"])])}var I=v(N,[["render",z]]);export{I as default};
