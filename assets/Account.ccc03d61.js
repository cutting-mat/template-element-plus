import{_ as e,D as a,d as t,r as l,B as o,C as r,o as i,c as s,e as d,w as n,k as u,l as c,g as m,t as p,F as g,h,a as f}from"./index.cc0542f8.js";import{a as b,r as _,b as F,e as V,c as y,l as w}from"./account.0e34fda8.js";import{l as P}from"./role.b1f6a579.js";const k={components:{OrgPicker:a((()=>f((()=>import("./OrgPicker.a44a1ead.js")),["assets/OrgPicker.a44a1ead.js","assets/OrgPicker.6f1aa395.css","assets/index.cc0542f8.js","assets/index.43470bb7.css","assets/org.22e24e45.js"])))},data(){return{account:b,dialogVisible:!1,loading:!1,list:[],editForm:{id:"",accountNumber:"",accountName:"",password:"",roles:[],state:1},queryParam:{pageSize:20,p:1,accountNumber:"",accountName:""},totalCount:0,totalPage:0,rules:{accountNumber:[{required:!0,message:"请输入账号",trigger:"blur"}],accountName:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{validator:(e,a,t)=>{a?(""!==this.editForm.checkPass&&this.$refs.editForm.validateField("checkPass"),t()):t(new Error("请输入密码"))},trigger:"blur"}],checkPass:[{validator:(e,a,t)=>{a?a!==this.editForm.password?t(new Error("两次输入密码不一致!")):t():t(new Error("请再次输入密码"))},trigger:"blur"}],orgId:[{required:!0,message:"请选择所属组织"}]},requestRoles:P}},methods:{resetSearch(){this.queryParam={pageSize:20,p:1,accountNumber:"",accountName:""},this.fetchData(!0)},orgAdapter(e){return this.editForm.belongOrgName||e},resetPassword:function(e){if(!e)return null;this.$confirm(`确定重置账号 ${e.accountNumber} 的密码?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.loading=!0,_({id:e.id}).then((e=>{e.data.password?this.$clipboard(e.data.password).then((()=>{this.$alert(`新密码已复制到剪贴板，请保管好新密码：<code>${e.data.password}</code>`,{confirmButtonText:"我知道了",dangerouslyUseHTMLString:!0}).then((()=>{this.fetchData()}))})).catch((()=>{this.$alert(`密码已重置，请牢记新密码：<code>${e.data.password}</code>`,{confirmButtonText:"我知道了",dangerouslyUseHTMLString:!0}).then((()=>{this.fetchData()}))})):this.$message.warning("操作失败，请重试")})).catch((()=>{this.loading=!1}))}))},edit:function(e){const a=Object.assign({},e);a.roles=Array.isArray(a.roles)?a.roles.map((e=>e.roleId)):[],this.editForm=a,this.dialogVisible=!0},save(){this.$refs.editForm.validate((e=>{if(e){this.loading=!0;let e=t(this.editForm);this.handleCloseDialog(),(e.id?V:F)(e).then((()=>{this.fetchData(),this.$message({message:"添加成功",type:"success"})})).catch((()=>{this.loading=!1}))}}))},handleCloseDialog:function(){this.dialogVisible=!1,this.editForm={id:"",accountNumber:"",accountName:"",password:"",roles:[],state:1},this.$refs.editForm&&this.$refs.editForm.resetFields()},remove(e){if(!e)return null;this.$confirm("是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.loading=!0,y({id:e.id}).then((()=>{this.fetchData(),this.$message({message:"删除成功",type:"success"})})).catch((()=>{this.loading=!1}))}))},fetchData:function(e){e&&(this.queryParam.p=1),this.loading=!0,w(this.queryParam).then((e=>{this.loading=!1;const a=e.data;a&&(this.list=a.list,this.totalCount=a.totalCount,this.totalPage=a.totalPage)})).catch((()=>{this.loading=!1}))}},created:function(){this.fetchData()}},v={class:"flex-col"},C=c(" 添加 "),N={class:"flex-1 scrollbar"},q=c(" 查询 "),D=c(" 重置 "),x=c(" 共 "),$=c(" 条记录 "),U={key:0,style:{color:"#ff4949"}},I={key:1,style:{color:"#13ce66"}},S=c("编辑"),T=c("重置密码"),B=c("删除"),z=["src"],O={key:1},E=c("确 定"),j=c("取 消");const A=e(k,[["render",function(e,a,t,f,b,_){const F=l("plus"),V=l("el-icon"),y=l("el-button"),w=l("ToolBar"),P=l("el-input"),k=l("el-form-item"),A=l("search"),M=l("refresh"),L=l("el-form"),R=l("info-filled"),H=l("el-link"),K=l("el-table-column"),G=l("el-table"),J=l("Pagination"),Q=l("uploader"),W=l("input-password"),X=l("OrgPicker"),Y=l("DictSelect"),Z=l("el-switch"),ee=l("el-dialog"),ae=o("auth"),te=o("loading");return r((i(),s("div",v,[d(w,null,{default:n((()=>[r((i(),m(y,{type:"primary",onClick:a[0]||(a[0]=e=>b.dialogVisible=!0)},{default:n((()=>[d(V,null,{default:n((()=>[d(F)])),_:1}),C])),_:1})),[[ae,b.account.add]])])),_:1}),u("div",N,[d(L,{ref:"searchForm",inline:"",model:b.queryParam},{default:n((()=>[d(k,{label:"账号"},{default:n((()=>[d(P,{modelValue:b.queryParam.accountNumber,"onUpdate:modelValue":a[1]||(a[1]=e=>b.queryParam.accountNumber=e)},null,8,["modelValue"])])),_:1}),d(k,{label:"用户名"},{default:n((()=>[d(P,{modelValue:b.queryParam.accountName,"onUpdate:modelValue":a[2]||(a[2]=e=>b.queryParam.accountName=e)},null,8,["modelValue"])])),_:1}),d(k,null,{default:n((()=>[d(y,{type:"primary",onClick:a[3]||(a[3]=e=>_.fetchData(!0))},{default:n((()=>[d(V,null,{default:n((()=>[d(A)])),_:1}),q])),_:1}),d(y,{onClick:a[4]||(a[4]=e=>_.resetSearch())},{default:n((()=>[d(V,null,{default:n((()=>[d(M)])),_:1}),D])),_:1})])),_:1})])),_:1},8,["model"]),u("p",null,[d(V,null,{default:n((()=>[d(R)])),_:1}),x,d(H,null,{default:n((()=>[c(p(b.totalCount),1)])),_:1}),$]),d(G,{data:b.list},{default:n((()=>[d(K,{prop:"accountNumber",label:"账号",align:"center"}),d(K,{prop:"accountName",label:"用户名",align:"center"}),d(K,{prop:"roleName",label:"角色",align:"center"}),d(K,{label:"状态",width:"80",align:"center"},{default:n((e=>[e.row.state?(i(),s("span",I,"已启用")):(i(),s("span",U,"已禁用"))])),_:1}),d(K,{label:"操作",width:"300",align:"center"},{default:n((e=>[r((i(),m(y,{onClick:a=>_.edit(e.row)},{default:n((()=>[S])),_:2},1032,["onClick"])),[[ae,b.account.edit]]),r((i(),m(y,{type:"warning",plain:"",onClick:a=>_.resetPassword(e.row)},{default:n((()=>[T])),_:2},1032,["onClick"])),[[ae,b.account.resetPassword]]),r((i(),m(y,{type:"danger",plain:"",onClick:a=>_.remove(e.row)},{default:n((()=>[B])),_:2},1032,["onClick"])),[[ae,b.account.remove]])])),_:1})])),_:1},8,["data"])]),d(J,{"page-size":b.queryParam.pageSize,"current-page":b.queryParam.p,"total-count":b.totalCount,"total-page":b.totalPage,onCurrentChange:a[5]||(a[5]=e=>{b.queryParam.p=e,_.fetchData()}),onSizeChange:a[6]||(a[6]=e=>{b.queryParam.pageSize=e,_.fetchData(!0)})},null,8,["page-size","current-page","total-count","total-page"]),d(ee,{"custom-class":"userEditDialog","close-on-click-modal":!1,title:"账号信息",modelValue:b.dialogVisible,"onUpdate:modelValue":a[16]||(a[16]=e=>b.dialogVisible=e),width:"600px","destroy-on-close":"",onClose:_.handleCloseDialog},{footer:n((()=>[d(y,{type:"primary",onClick:_.save},{default:n((()=>[E])),_:1},8,["onClick"]),d(y,{onClick:a[15]||(a[15]=e=>b.dialogVisible=!1)},{default:n((()=>[j])),_:1})])),default:n((()=>[d(L,{ref:"editForm",rules:b.rules,model:b.editForm,"label-width":"80px"},{default:n((()=>[d(k,{label:"头像",prop:"avatar"},{default:n((()=>[d(Q,{class:"upload_avatar",accept:"t-image",modelValue:b.editForm.avatar?[{url:b.editForm.avatar}]:[],imgCrop:"","show-file-list":!1,"on-success":e=>{b.editForm.avatar=e.url}},{default:n((()=>[b.editForm.avatar?(i(),s("img",{key:0,class:"upload_avatar_img",src:b.editForm.avatar,alt:""},null,8,z)):(i(),s("span",O,"上传头像"))])),_:1},8,["modelValue","on-success"])])),_:1}),d(k,{label:"账号",prop:"accountNumber"},{default:n((()=>[d(P,{modelValue:b.editForm.accountNumber,"onUpdate:modelValue":a[7]||(a[7]=e=>b.editForm.accountNumber=e),modelModifiers:{trim:!0},maxlength:100},null,8,["modelValue"])])),_:1}),d(k,{label:"用户名",prop:"accountName"},{default:n((()=>[d(P,{modelValue:b.editForm.accountName,"onUpdate:modelValue":a[8]||(a[8]=e=>b.editForm.accountName=e),modelModifiers:{trim:!0},maxlength:100},null,8,["modelValue"])])),_:1}),b.editForm.id?h("",!0):(i(),s(g,{key:0},[d(k,{label:"密码",prop:"password"},{default:n((()=>[d(W,{modelValue:b.editForm.password,"onUpdate:modelValue":a[9]||(a[9]=e=>b.editForm.password=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),d(k,{label:"确认密码",prop:"checkPass"},{default:n((()=>[d(P,{type:"password",modelValue:b.editForm.checkPass,"onUpdate:modelValue":a[10]||(a[10]=e=>b.editForm.checkPass=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})],64)),d(k,{label:"所属组织",prop:"orgId"},{default:n((()=>[d(X,{modelValue:b.editForm.orgId,"onUpdate:modelValue":[a[11]||(a[11]=e=>b.editForm.orgId=e),a[12]||(a[12]=(a,t)=>{b.editForm.belongOrgName=t.name,e.$refs.editForm.validateField("orgId")})],adapter:_.orgAdapter},null,8,["modelValue","adapter"])])),_:1}),d(k,{label:"角色"},{default:n((()=>[d(Y,{modelValue:b.editForm.roleId,"onUpdate:modelValue":a[13]||(a[13]=e=>b.editForm.roleId=e),request:b.requestRoles,labelKey:"name"},null,8,["modelValue","request"])])),_:1}),d(k,{label:"状态"},{default:n((()=>[d(Z,{modelValue:b.editForm.state,"onUpdate:modelValue":a[14]||(a[14]=e=>b.editForm.state=e),"active-text":"启用","inactive-text":"禁用","active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue","onClose"])])),[[te,b.loading]])}],["__scopeId","data-v-e3f03c6e"]]);export{A as default};
